# ES業務フロー セキュリティ詳細設計

## 1. はじめに

この文書は、ES業務フローシステムのセキュリティに関する詳細な設計方針を示すものです。システムの脆弱性を最小限に抑え、機密性を確保し、データの完全性を維持することを目的とします。これまでの要件定義および技術定義におけるセキュリティに関する検討事項を具体化します。

## 2. 認証・認可設計

*   **認証 (Authentication):**
    *   ログインIDとして社員番号（`employee_number`）を使用します。
    *   パスワードはソルト付きハッシュ化してデータベースに安全に保管します。
    *   初期パスワード（`3290`）を設定されたユーザーは、初回ログイン時にパスワードの強制変更を求められます。変更後のパスワードは安全なパスワードポリシー（例: 最低文字数、英数字記号の組み合わせ要求など）に準拠する必要があります。
    *   一定回数以上のログイン失敗があった場合、アカウントロックや遅延処理を行い、ブルートフォース攻撃を防ぎます。
    *   セッション管理には安全なメカニズム（例: サーバサイドでのセッション管理、JWTの場合は適切な署名検証と有効期限管理）を使用します。
    *   多要素認証 (MFA) の導入を検討します（リスクレベルに応じて判断）。

*   **認可 (Authorization):**
    *   役割ベースのアクセス制御 (RBAC) を実装します。各ユーザーには「営業担当者」「本部担当者」「施工担当者」「管理者」などの役割が割り当てられます。
    *   システム内の各リソース（URL、データ、機能ボタンなど）に対して、アクセスを許可する役割を細かく定義します。
    *   APIレベルでの認可チェックを必須とします。UI上で要素を非表示にするだけでなく、バックエンドでも常にアクセス権限を確認します。
    *   データに対するアクセス制御も行います。例: 営業担当者は自身が担当する案件や顧客の情報にアクセスできるが、他の営業担当者の担当情報を直接参照するには別途権限が必要、など。

## 3. 入力値検証とサニタイズ

*   ユーザーからの入力値は、バックエンドで必ず厳密な検証（データ型、形式、長さ、必須チェックなど）を行います。
*   データベースに保存したり、画面に表示したりする前に、悪意のあるコード（スクリプト、SQL断片など）が含まれていないかサニタイズ処理を行います。
*   特に、検索条件、登録・更新データ、ファイルアップロードなど、ユーザーが自由に値を入力できる箇所は重点的に対策します。

## 4. データ保護

*   **保管時の保護 (Encryption at Rest):** 機密性の高いデータ（顧客情報、契約情報など）が保存されるデータベースやファイルストレージに対して、暗号化の適用を検討します。
*   **転送時の保護 (Encryption in Transit):** ユーザーのブラウザとサーバー間、およびサーバー内部の各コンポーネント間の通信は、HTTPS/TLSを使用して暗号化します。
*   **データベースアクセス:** アプリケーションからデータベースへの接続には、最小限の権限を持つ専用ユーザーを使用し、接続情報も安全に管理します。

## 5. ログと監視

*   **セキュリティ関連ログ:** ログイン試行（成功/失敗）、認証エラー、認可エラー（権限不足によるアクセス拒否）、重要なデータ操作（登録、更新、削除、参照）、設定変更などのセキュリティに関連するイベントを詳細にログとして記録します。
*   **ログの保護:** 記録されたログは改ざんされないように保護し、一定期間保管します。
*   **監視とアラート:** 不正アクセス試行、異常なデータアクセスパターン、システムエラーなどを監視し、異常が検知された場合は担当者にアラートを通知する仕組みを構築します。

## 6. 脆弱性対策

*   使用するフレームワーク、ライブラリ、OS、データベースなどのソフトウェアは常に最新のセキュリティパッチを適用します。
*   定期的にセキュリティ診断（脆弱性スキャン、ペネトレーションテストなど）を実施し、潜在的な脆弱性を特定・修正します。
*   OWASP Top 10などの一般的なウェブアプリケーションの脆弱性リストを参考に、対策が漏れていないか確認します。

## 7. 今後の詳細化

*   具体的な役割と機能/データアクセス権限のマッピング定義。
*   多要素認証 (MFA) を導入する場合の方式と実装詳細。
*   パスワード忘れ、アカウントロック解除などの運用におけるセキュリティ手順。
*   インフラレベルでのセキュリティ対策（ファイアウォール設定、ネットワーク分離など）の詳細。 