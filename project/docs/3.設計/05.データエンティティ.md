# ES業務フロー データエンティティ定義

## 1. エンティティ一覧

*   オーナー (Owner)
*   不動産会社/管理会社 (Company)
*   業務提携 (BusinessAlliance)
*   物件 (Property)
*   案件 (Case)
*   工事種別 (ConstructionType)
*   見積書 (Estimate)
*   見積明細 (EstimateItem)
*   契約書 (Contract)
*   契約明細 (ContractItem)
*   調査/点検記録 (SurveyRecord)
*   報告/商談記録 (ReportRecord)
*   スケジュール (Schedule)
*   ユーザー (User)

## 2. エンティティ定義と属性

### 2.1. オーナー (Owner)
*   owner_id (PK)
*   name
*   contact_info (e.g., phone, email)
*   address
*   担当営業 (user_id - FK)
*   登録日
*   更新日

### 2.2. 不動産会社/管理会社 (Company)
*   company_id (PK)
*   name
*   contact_info
*   address
*   担当者名
*   登録日
*   更新日

### 2.3. 業務提携 (BusinessAlliance)
*   alliance_id (PK)
*   company_id (FK)
*   start_date
*   紹介手数料率
*   契約書情報（関連する契約書へのリンクや情報保持）
*   登録日
*   更新日

### 2.4. 物件 (Property)
*   property_id (PK)
*   owner_id (FK)
*   company_id (FK, 管理会社の場合)
*   address
*   property_type (集合住宅, 戸建てなど)
*   築年数
*   最終点検/工事日
*   登録日
*   更新日

### 2.5. 案件 (Case)
*   case_id (PK)
*   owner_id (FK)
*   property_id (FK)
*   担当営業 (user_id - FK)
*   case_type (新規, CS)
*   status (アポ取得済, 調査/点検済, 商談中, 契約済, 施工中, 完了, 中止など)
*   発生日
*   想定工事種別 (construction_type_id - FK, 複数紐付けの可能性あり)
*   登録日
*   更新日

### 2.6. 工事種別 (ConstructionType)
*   construction_type_id (PK)
*   name
*   description
*   登録日
*   更新日

### 2.7. 見積書 (Estimate)
*   estimate_id (PK)
*   case_id (FK)
*   作成日
*   有効期限
*   合計金額
*   承認ステータス (未承認, 承認済, 却下)
*   承認者 (user_id - FK)
*   承認日
*   登録日
*   更新日

### 2.8. 見積明細 (EstimateItem)
*   estimate_item_id (PK)
*   estimate_id (FK)
*   item_name
*   quantity
*   unit_price
*   subtotal

### 2.9. 契約書 (Contract)
*   contract_id (PK)
*   case_id (FK)
*   estimate_id (FK, 見積書との紐付け)
*   contract_type (注文書, 契約書, 契約兼完了確認書)
*   contract_date
*   contract_amount
*   施工希望日
*   支払い条件
*   オーナー記入日
*   承認ステータス (未承認, 承認済, 却下 - 本部チェック)
*   承認者 (user_id - FK)
*   承認日
*   お客様確認ステータス (要, 不要, 未実施, 実施済OK, 実施済NG)
*   お客様確認日
*   お客様確認担当者 (user_id - FK)
*   登録日
*   更新日

### 2.10. 契約明細 (ContractItem)
*   contract_item_id (PK)
*   contract_id (FK)
*   item_name
*   quantity
*   unit_price
*   subtotal
*   (見積明細からの引用情報)

### 2.11. 調査/点検記録 (SurveyRecord)
*   survey_id (PK)
*   case_id (FK)
*   survey_date
*   担当者 (user_id - FK)
*   概要
*   結果詳細
*   添付資料（写真など）へのパス/参照
*   登録日
*   更新日

### 2.12. 報告/商談記録 (ReportRecord)
*   report_id (PK)
*   case_id (FK)
*   report_date
*   担当者 (user_id - FK)
*   商談内容
*   結果 (受注, 失注, 継続など)
*   登録日
*   更新日

### 2.13. スケジュール (Schedule)
*   schedule_id (PK)
*   case_id (FK, 関連する場合)
*   user_id (FK, 担当者)
*   schedule_date
*   start_time
*   end_time
*   type (アポイント, 施工)
*   location
*   details
*   登録日
*   更新日

### 2.14. ユーザー (User)
*   user_id (PK)
*   login_id
*   password (hashed)
*   name
*   role (営業担当者, 本部担当者, 施工担当者)
*   登録日
*   最終ログイン日
*   employee_number (ログインIDとして使用)
*   is_first_login (初回ログインフラグ)

## 3. エンティティ関連性 (リレーションシップ)

*   **Owner** 1 : N **Property** (一人のオーナーは複数の物件を持つ)
*   **Owner** 1 : N **Case** (一人のオーナーに対して複数の案件が発生しうる)
*   **Company** 1 : N **BusinessAlliance** (一つの不動産会社/管理会社は複数の業務提携を結びうる)
*   **Company** 1 : N **Property** (一つの管理会社が複数の物件を管理しうる)
*   **Company** 1 : N **Case** (一つの不動産会社/管理会社から複数の案件紹介がありうる)
*   **User** 1 : N **Owner** (一人の営業担当者が複数のオーナーを担当)
*   **User** 1 : N **Case** (一人の担当営業が複数の案件を担当)
*   **User** 1 : N **Schedule** (一人のユーザーは複数のスケジュールを持つ)
*   **User** 1 : N **SurveyRecord** (一人のユーザーが複数の調査記録を担当)
*   **User** 1 : N **ReportRecord** (一人のユーザーが複数の報告記録を担当)
*   **User** 1 : N **Estimate** (一人の本部担当者が複数の見積書を承認)
*   **User** 1 : N **Contract** (一人の本部担当者が複数の契約書を承認)
*   **Case** 1 : N **SurveyRecord** (一つの案件に対して複数の調査記録が作成されうる)
*   **Case** 1 : N **ReportRecord** (一つの案件に対して複数の報告記録が作成されうる)
*   **Case** 1 : 1 **Estimate** (一つの案件に対して作成される見積書は通常一つ)
*   **Estimate** 1 : N **EstimateItem** (一つの見積書は複数の明細を持つ)
*   **Case** 1 : N **Contract** (一つの案件に対して複数の契約書（形式）が作成されうる)
*   **Contract** 1 : N **ContractItem** (一つの契約書は複数の明細を持つ)
*   **Contract** 1 : 1 **Estimate** (一つの契約書は通常一つの見積書と紐づく)
*   **Case** 1 : N **Schedule** (一つの案件に対して複数のアポイントや施工スケジュールが紐づく)
*   **ConstructionType** N : N **Case** (一つの案件は複数の工事種別を含みうる) 